@using MudBlazor
@using jobsearch.Models
@using Microsoft.AspNetCore.Components.Web
@inject ISnackbar Snackbar

 

<MudDialog>
    <DialogContent>
        <MudGrid Spacing="3">

          

            <!-- Row 1 -->
            <MudItem xs="12" sm="6">
                <MudTextField Variant="Variant.Outlined"
                           
                              @bind-Value="_edit.BusinessOrOrganization"
                              Label="Business / Organization"
                              Required />
            </MudItem>

            <MudItem xs="12" sm="3">
                <MudTextField Variant="Variant.Outlined"
                              @bind-Value="_edit.TypeOfWork"
                              Label="Type of Work"
                              Required />
            </MudItem>

          

            <MudItem xs="12" sm="3">
                <MudTextField Variant="Variant.Outlined"
                              @bind-Value="_edit.ContactPerson"
                              Label="Contact Person" />
            </MudItem>


            <!-- Row 2 -->
            <MudItem xs="12" sm="3">
                <MudTextField @ref="activityDateField" 
                              Variant="Variant.Outlined"
                              @bind-Value="Activity_Date" 
                              Label="Date"
                              @onkeydown="OnDateKeyDown"
                              Required />
            </MudItem>

            <MudItem xs="12" sm="5">
                <MudTextField Variant="Variant.Outlined"
                              @bind-Value="_edit.ActivityPerformed"
                              Label="Activity Performed"
                              Required />
            </MudItem>

            <MudItem xs="12" sm="4">
                <MudTextField Variant="Variant.Outlined"
                              @bind-Value="_edit.HowPerformed"
                              Label="How Performed" />
            </MudItem>

          



            <!-- Row 3 -->
            <MudItem xs="12">
                <MudTextField Variant="Variant.Outlined"
                              @bind-Value="_edit.Results"
                              Label="Results"
                              Required />
            </MudItem>

            <!-- Notes -->
            <MudItem xs="12">
                <MudTextField Variant="Variant.Outlined"
                              @bind-Value="_edit.Notes"
                              Label="Notes"
                              Lines="4" />
            </MudItem>

        </MudGrid>
    </DialogContent>

    <DialogActions>
        <MudButton Variant="Variant.Text" OnClick="Cancel">Cancel</MudButton>
        <MudButton Variant="Variant.Filled" OnClick="Save">Save</MudButton>
    </DialogActions>
</MudDialog>



@code {
    [CascadingParameter] public IMudDialogInstance MudDialog { get; set; } = default!;

    [Parameter] public ActivityLog Model { get; set; } = new();

    private ActivityLog _edit = new();

    private string Activity_Date = string.Empty;

    private MudTextField<string> activityDateField = default!;

    protected override void OnInitialized()
    {
        // work on a copy so Cancel doesn't mutate the original row
        _edit = new ActivityLog
        {
            Id = Model.Id,
            ActivityDate = Model.ActivityDate,
            BusinessOrOrganization = Model.BusinessOrOrganization,
            ActivityPerformed = Model.ActivityPerformed,
            TypeOfWork = Model.TypeOfWork,
            Results = Model.Results,
            ContactPerson = Model.ContactPerson,
            HowPerformed = Model.HowPerformed,
            Notes = Model.Notes
        };

        if (string.IsNullOrWhiteSpace(_edit.ActivityDate))
            _edit.ActivityDate = DateTime.Today.ToString("yyyy-MM-dd");

        Activity_Date = _edit.ActivityDate;
    }

    private async Task OnDateKeyDown(KeyboardEventArgs e)
    {
        if (e.Key.ToLower() == "t")
        {
            Activity_Date = DateTime.Now.ToString("yyyy-MM-dd");
            await activityDateField.SetText(Activity_Date);
        }
        else if (e.Key == "+" || e.Key == "=") // "=" because shift isn't always detected
        {
            if (DateTime.TryParse(Activity_Date, out DateTime currentDate))
            {
                Activity_Date = currentDate.AddDays(1).ToString("yyyy-MM-dd");
                await activityDateField.SetText(Activity_Date);
            }
        }
        else if (e.Key == "-")
        {
            if (DateTime.TryParse(Activity_Date, out DateTime currentDate))
            {
                Activity_Date = currentDate.AddDays(-1).ToString("yyyy-MM-dd");
                await activityDateField.SetText(Activity_Date);
            }
        }
    }


    private void Cancel() => MudDialog.Cancel();


    private void Save() => MudDialog.Close(DialogResult.Ok(_edit));
}
